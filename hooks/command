#!/bin/bash
set -euo pipefail

version="${BUILDKITE_PLUGIN_MONOREPO_DIFF_BUILDKITE_PLUGIN_VERSION:-2.0.1}"
repo="https://github.com/chronotc/monorepo-diff-buildkite-plugin"
executable="monorepo-diff-buildkite-plugin-linux"

test_mode="${BUILDKITE_PLUGIN_MONOREPO_DIFF_BUILDKITE_PLUGIN_TEST_MODE:-false}"

if [[ "$test_mode" == "false" ]]; then
  curl -Lf -o ${executable} ${repo}/releases/download/v${version}/${executable} \
    && chmod +x ${executable}
fi

./${executable}
